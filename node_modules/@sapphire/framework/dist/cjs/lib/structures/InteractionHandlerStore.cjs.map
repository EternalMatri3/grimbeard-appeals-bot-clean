{"version":3,"sources":["../../../../src/lib/structures/InteractionHandlerStore.ts"],"names":["Store","InteractionHandler","result","Result","Events","InteractionHandlerTypes"],"mappings":";;;;;;;;;AAMO,IAAM,wBAAA,GAAN,MAAM,wBAAA,SAAgCA,YAAA,CAAkD;AAAA,EACvF,WAAA,GAAc;AACpB,IAAA,KAAA,CAAMC,yCAAA,EAAoB,EAAE,IAAA,EAAM,sBAAA,EAAwB,CAAA;AAAA,EAC3D;AAAA,EAEA,MAAa,IAAI,WAAA,EAA0B;AAE1C,IAAA,IAAI,IAAA,CAAK,IAAA,KAAS,CAAA,EAAG,OAAO,KAAA;AAE5B,IAAA,MAAM,WAAmH,EAAC;AAG1H,IAAA,KAAA,MAAW,OAAA,IAAW,IAAA,CAAK,MAAA,EAAO,EAAG;AACpC,MAAA,MAAM,MAAA,GAAS,yBAAA,CAA0B,GAAA,CAAI,OAAA,CAAQ,sBAAsB,CAAA;AAI3E,MAAA,IAAI,CAAC,MAAA,GAAS,WAAW,CAAA,EAAG;AAG5B,MAAA,MAAMC,QAAA,GAAS,MAAMC,aAAA,CAAO,SAAA,CAAU,MAAM,OAAA,CAAQ,KAAA,CAAM,WAAW,CAAC,CAAA;AACtE,MAAAD,QAAA,CAAO,KAAA,CAAM;AAAA,QACZ,EAAA,0BAAK,MAAA,KAAW;AAEf,UAAA,IAAA,CAAK,SAAA,CAAU,OAAO,IAAA,CAAKE,iBAAA,CAAO,gCAAgC,MAAA,EAAQ,EAAE,WAAA,EAAa,OAAA,EAAS,CAAA;AAElG,UAAA,MAAA,CAAO,KAAA,CAAM;AAAA;AAAA,YAEZ,IAAA,0BAAO,KAAA,KAAU;AAEhB,cAAA,IAAA,CAAK,SAAA,CAAU,MAAA,CAAO,IAAA,CAAKA,iBAAA,CAAO,6BAA6B,MAAA,EAAqC;AAAA,gBACnG,WAAA;AAAA,gBACA,OAAA;AAAA,gBACA;AAAA,eACA,CAAA;AAGD,cAAA,MAAM,OAAA,GAAUD,cAAO,SAAA,CAAU,MAAM,QAAQ,GAAA,CAAI,WAAA,EAAa,KAAK,CAAC,CAAA,CACpE,KAAK,CAAC,GAAA,KAAQ,IAAI,MAAA,CAAO,CAAC,WAAW,EAAE,OAAA,EAAS,KAAA,EAAM,CAAE,CAAC,CAAA;AAE3D,cAAA,QAAA,CAAS,KAAK,OAAO,CAAA;AAAA,YACtB,CAAA,EAbM,MAAA,CAAA;AAAA;AAAA,YAeN,IAAA,kBAAM,MAAA,CAAA,MAAM,IAAA,CAAK,SAAA,CAAU,MAAA,CAAO,IAAA,CAAKC,iBAAA,CAAO,2BAAA,EAA6B,MAAA,EAAuB,EAAE,WAAA,EAAa,OAAA,EAAS,CAAA,EAApH,MAAA;AAAA,WACN,CAAA;AAAA,QACF,CAAA,EAvBI,IAAA,CAAA;AAAA,QAwBJ,GAAA,0BAAM,KAAA,KAAU;AAEf,UAAA,IAAA,CAAK,SAAA,CAAU,OAAO,IAAA,CAAKA,iBAAA,CAAO,8BAA8B,KAAA,EAAO,EAAE,WAAA,EAAa,OAAA,EAAS,CAAA;AAAA,QAChG,CAAA,EAHK,KAAA;AAAA,OAIL,CAAA;AAAA,IACF;AAGA,IAAA,IAAI,QAAA,CAAS,MAAA,KAAW,CAAA,EAAG,OAAO,KAAA;AAElC,IAAA,MAAM,OAAA,GAAU,MAAM,OAAA,CAAQ,UAAA,CAAW,QAAQ,CAAA;AAEjD,IAAA,KAAA,MAAW,UAAU,OAAA,EAAS;AAC7B,MAAA,MAAM,MACL,MAAA,CASC,KAAA;AAEF,MAAA,GAAA,CAAI,UAAA;AAAA,QAAW,CAAC,KAAA,KACf,IAAA,CAAK,SAAA,CAAU,OAAO,IAAA,CAAKA,iBAAA,CAAO,uBAAA,EAAyB,KAAA,CAAM,OAAO,EAAE,WAAA,EAAa,OAAA,EAAS,KAAA,CAAM,SAAS;AAAA,OAChH;AAAA,IACD;AAEA,IAAA,OAAO,IAAA;AAAA,EACR;AACD,CAAA;AA9E+F,MAAA,CAAA,wBAAA,EAAA,yBAAA,CAAA;AAAxF,IAAM,uBAAA,GAAN;AAgFA,IAAM,yBAAA,uBAAgC,GAAA,CAAoE;AAAA,EAChH,CAACC,8CAAA,CAAwB,MAAA,EAAQ,CAAC,WAAA,KAAgB,WAAA,CAAY,UAAU,CAAA;AAAA,EACxE,CAACA,8CAAA,CAAwB,UAAA,EAAY,CAAC,WAAA,KAAgB,WAAA,CAAY,iBAAiB,CAAA;AAAA,EACnF,CAACA,8CAAA,CAAwB,WAAA,EAAa,CAAC,WAAA,KAAgB,WAAA,CAAY,eAAe,CAAA;AAAA,EAElF,CAACA,8CAAA,CAAwB,gBAAA,EAAkB,CAAC,WAAA,KAAgB,WAAA,CAAY,oBAAoB,CAAA;AAAA,EAC5F,CAACA,8CAAA,CAAwB,YAAA,EAAc,CAAC,WAAA,KAAgB,WAAA,CAAY,gBAAgB;AACrF,CAAC","file":"InteractionHandlerStore.cjs","sourcesContent":["import { Store } from '@sapphire/pieces';\nimport { Result, type Option } from '@sapphire/result';\nimport type { Interaction } from 'discord.js';\nimport { Events } from '../types/Events';\nimport { InteractionHandler, InteractionHandlerTypes, type InteractionHandlerOptions } from './InteractionHandler';\n\nexport class InteractionHandlerStore extends Store<InteractionHandler, 'interaction-handlers'> {\n\tpublic constructor() {\n\t\tsuper(InteractionHandler, { name: 'interaction-handlers' });\n\t}\n\n\tpublic async run(interaction: Interaction) {\n\t\t// Early-exit for optimization\n\t\tif (this.size === 0) return false;\n\n\t\tconst promises: Promise<Result<unknown, { handler: InteractionHandler<InteractionHandlerOptions>; error: unknown }>>[] = [];\n\n\t\t// Iterate through every registered handler\n\t\tfor (const handler of this.values()) {\n\t\t\tconst filter = InteractionHandlerFilters.get(handler.interactionHandlerType);\n\n\t\t\t// If the filter is missing (we don't support it or someone didn't register it manually while waiting for us to implement it),\n\t\t\t// or it doesn't match the expected handler type, skip the handler\n\t\t\tif (!filter?.(interaction)) continue;\n\n\t\t\t// Get the result of the `parse` method in the handler\n\t\t\tconst result = await Result.fromAsync(() => handler.parse(interaction));\n\t\t\tresult.match({\n\t\t\t\tok: (option) => {\n\t\t\t\t\t// Emit an event to the user to let them know `parse` was successful\n\t\t\t\t\tthis.container.client.emit(Events.InteractionHandlerParseSuccess, option, { interaction, handler });\n\n\t\t\t\t\toption.match({\n\t\t\t\t\t\t// If the `parse` method returned a `Some` (whatever that `Some`'s value is, it should be handled)\n\t\t\t\t\t\tsome: (value) => {\n\t\t\t\t\t\t\t// Emit an event to the user to let them know parse was successful and `some` was returned.\n\t\t\t\t\t\t\tthis.container.client.emit(Events.InteractionHandlerParseSome, option as Option.Some<typeof value>, {\n\t\t\t\t\t\t\t\tinteraction,\n\t\t\t\t\t\t\t\thandler,\n\t\t\t\t\t\t\t\tvalue\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// Schedule the run of the handler method\n\t\t\t\t\t\t\tconst promise = Result.fromAsync(() => handler.run(interaction, value)) //\n\t\t\t\t\t\t\t\t.then((res) => res.mapErr((error) => ({ handler, error })));\n\n\t\t\t\t\t\t\tpromises.push(promise);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t// Emit an event to the user to let them know parse was successful and `none` was returned.\n\t\t\t\t\t\tnone: () => this.container.client.emit(Events.InteractionHandlerParseNone, option as Option.None, { interaction, handler })\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\terr: (error) => {\n\t\t\t\t\t// If the `parse` method threw an error (spoiler: please don't), skip the handler\n\t\t\t\t\tthis.container.client.emit(Events.InteractionHandlerParseError, error, { interaction, handler });\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Yet another early exit\n\t\tif (promises.length === 0) return false;\n\n\t\tconst results = await Promise.allSettled(promises);\n\n\t\tfor (const result of results) {\n\t\t\tconst res = (\n\t\t\t\tresult as PromiseFulfilledResult<\n\t\t\t\t\tResult<\n\t\t\t\t\t\tunknown,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\terror: Error;\n\t\t\t\t\t\t\thandler: InteractionHandler;\n\t\t\t\t\t\t}\n\t\t\t\t\t>\n\t\t\t\t>\n\t\t\t).value;\n\n\t\t\tres.inspectErr((value) =>\n\t\t\t\tthis.container.client.emit(Events.InteractionHandlerError, value.error, { interaction, handler: value.handler })\n\t\t\t);\n\t\t}\n\n\t\treturn true;\n\t}\n}\n\nexport const InteractionHandlerFilters = new Map<InteractionHandlerTypes, (interaction: Interaction) => boolean>([\n\t[InteractionHandlerTypes.Button, (interaction) => interaction.isButton()],\n\t[InteractionHandlerTypes.SelectMenu, (interaction) => interaction.isAnySelectMenu()],\n\t[InteractionHandlerTypes.ModalSubmit, (interaction) => interaction.isModalSubmit()],\n\n\t[InteractionHandlerTypes.MessageComponent, (interaction) => interaction.isMessageComponent()],\n\t[InteractionHandlerTypes.Autocomplete, (Interaction) => Interaction.isAutocomplete()]\n]);\n"]}