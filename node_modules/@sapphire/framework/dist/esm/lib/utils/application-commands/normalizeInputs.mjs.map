{"version":3,"sources":["../../../../../src/lib/utils/application-commands/normalizeInputs.ts"],"names":[],"mappings":"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","file":"normalizeInputs.mjs","sourcesContent":["import {\n\tContextMenuCommandBuilder,\n\tSlashCommandBuilder,\n\ttype SlashCommandOptionsOnlyBuilder,\n\ttype SlashCommandSubcommandsOnlyBuilder\n} from '@discordjs/builders';\nimport { isFunction } from '@sapphire/utilities';\nimport {\n\tApplicationCommandType,\n\ttype APIApplicationCommandOption,\n\ttype RESTPostAPIApplicationCommandsJSONBody,\n\ttype RESTPostAPIChatInputApplicationCommandsJSONBody,\n\ttype RESTPostAPIContextMenuApplicationCommandsJSONBody\n} from 'discord-api-types/v10';\nimport {\n\tApplicationCommand,\n\tPermissionsBitField,\n\ttype ApplicationIntegrationType,\n\ttype ChatInputApplicationCommandData,\n\ttype InteractionContextType,\n\ttype MessageApplicationCommandData,\n\ttype UserApplicationCommandData\n} from 'discord.js';\n\nfunction isBuilder(\n\tcommand: unknown\n): command is\n\t| SlashCommandBuilder\n\t| SlashCommandSubcommandsOnlyBuilder\n\t| SlashCommandOptionsOnlyBuilder\n\t| Omit<SlashCommandBuilder, 'addSubcommand' | 'addSubcommandGroup'> {\n\treturn command instanceof SlashCommandBuilder;\n}\n\nfunction addDefaultsToChatInputJSON(data: RESTPostAPIChatInputApplicationCommandsJSONBody): RESTPostAPIChatInputApplicationCommandsJSONBody {\n\tdata.dm_permission ??= true;\n\tdata.type ??= ApplicationCommandType.ChatInput;\n\tdata.default_member_permissions ??= null;\n\n\treturn data;\n}\n\nfunction addDefaultsToContextMenuJSON(data: RESTPostAPIContextMenuApplicationCommandsJSONBody): RESTPostAPIContextMenuApplicationCommandsJSONBody {\n\tdata.dm_permission ??= true;\n\tdata.default_member_permissions ??= null;\n\n\treturn data;\n}\n\nexport function normalizeChatInputCommand(\n\tcommand:\n\t\t| ChatInputApplicationCommandData\n\t\t| SlashCommandBuilder\n\t\t| SlashCommandSubcommandsOnlyBuilder\n\t\t| SlashCommandOptionsOnlyBuilder\n\t\t| Omit<SlashCommandBuilder, 'addSubcommand' | 'addSubcommandGroup'>\n\t\t| ((builder: SlashCommandBuilder) => unknown)\n): RESTPostAPIChatInputApplicationCommandsJSONBody {\n\tif (isFunction(command)) {\n\t\tconst builder = new SlashCommandBuilder();\n\t\tcommand(builder);\n\t\treturn addDefaultsToChatInputJSON(builder.toJSON() as RESTPostAPIChatInputApplicationCommandsJSONBody);\n\t}\n\n\tif (isBuilder(command)) {\n\t\treturn addDefaultsToChatInputJSON(command.toJSON() as RESTPostAPIChatInputApplicationCommandsJSONBody);\n\t}\n\n\tconst finalObject: RESTPostAPIChatInputApplicationCommandsJSONBody = {\n\t\tname: command.name,\n\t\tname_localizations: command.nameLocalizations,\n\t\tdescription: command.description,\n\t\tdescription_localizations: command.descriptionLocalizations,\n\t\ttype: ApplicationCommandType.ChatInput,\n\t\tdm_permission: command.dmPermission,\n\t\tnsfw: command.nsfw,\n\t\tintegration_types: command.integrationTypes as ApplicationIntegrationType[] | undefined,\n\t\tcontexts: command.contexts as InteractionContextType[] | undefined\n\t};\n\n\tif (typeof command.defaultMemberPermissions !== 'undefined') {\n\t\tfinalObject.default_member_permissions =\n\t\t\tcommand.defaultMemberPermissions === null ? null : new PermissionsBitField(command.defaultMemberPermissions).bitfield.toString();\n\t}\n\n\tif (command.options?.length) {\n\t\tfinalObject.options = command.options.map((option) => ApplicationCommand['transformOption'](option) as APIApplicationCommandOption);\n\t}\n\n\treturn addDefaultsToChatInputJSON(finalObject);\n}\n\nexport function normalizeContextMenuCommand(\n\tcommand:\n\t\t| UserApplicationCommandData\n\t\t| MessageApplicationCommandData\n\t\t| ContextMenuCommandBuilder\n\t\t| ((builder: ContextMenuCommandBuilder) => unknown)\n): RESTPostAPIContextMenuApplicationCommandsJSONBody {\n\tif (isFunction(command)) {\n\t\tconst builder = new ContextMenuCommandBuilder();\n\t\tcommand(builder);\n\t\treturn addDefaultsToContextMenuJSON(builder.toJSON() as RESTPostAPIContextMenuApplicationCommandsJSONBody);\n\t}\n\n\tif (command instanceof ContextMenuCommandBuilder) {\n\t\treturn addDefaultsToContextMenuJSON(command.toJSON() as RESTPostAPIContextMenuApplicationCommandsJSONBody);\n\t}\n\n\tconst finalObject: RESTPostAPIContextMenuApplicationCommandsJSONBody = {\n\t\tname: command.name,\n\t\tname_localizations: command.nameLocalizations,\n\t\t// TODO (favna 2024-10-19): Remove this line after discord.js has been updated past 14.16.3\n\t\t// @ts-ignore temporarily ignore the error because discord.js broke types\n\t\ttype: command.type,\n\t\tdm_permission: command.dmPermission,\n\t\tnsfw: command.nsfw,\n\t\tintegration_types: command.integrationTypes as ApplicationIntegrationType[] | undefined,\n\t\tcontexts: command.contexts as InteractionContextType[] | undefined\n\t};\n\n\tif (typeof command.defaultMemberPermissions !== 'undefined') {\n\t\tfinalObject.default_member_permissions =\n\t\t\tcommand.defaultMemberPermissions === null ? null : new PermissionsBitField(command.defaultMemberPermissions).bitfield.toString();\n\t}\n\n\treturn addDefaultsToContextMenuJSON(finalObject);\n}\n\nexport function convertApplicationCommandToApiData(command: ApplicationCommand): RESTPostAPIApplicationCommandsJSONBody {\n\tconst returnData = {\n\t\tname: command.name,\n\t\tname_localizations: command.nameLocalizations,\n\t\tdm_permission: command.dmPermission,\n\t\tnsfw: command.nsfw,\n\t\tdefault_member_permissions: command.defaultMemberPermissions?.bitfield.toString() ?? null,\n\t\tintegration_types: command.integrationTypes,\n\t\tcontexts: command.contexts\n\t} as RESTPostAPIApplicationCommandsJSONBody;\n\n\tif (command.type === ApplicationCommandType.ChatInput) {\n\t\treturnData.type = ApplicationCommandType.ChatInput;\n\t\t(returnData as RESTPostAPIChatInputApplicationCommandsJSONBody).description = command.description;\n\t\t// TODO (favna): Remove this line after website rewrite is done\n\t\t// @ts-ignore this is currently ignored for the website\n\t\t(returnData as RESTPostAPIChatInputApplicationCommandsJSONBody).description_localizations = command.descriptionLocalizations;\n\t} else if (command.type === ApplicationCommandType.Message) {\n\t\treturnData.type = ApplicationCommandType.Message;\n\t} else if (command.type === ApplicationCommandType.User) {\n\t\treturnData.type = ApplicationCommandType.User;\n\t} else {\n\t\tthrow new Error(`Unknown command type received: ${command.type}`);\n\t}\n\n\tif (command.options.length) {\n\t\treturnData.options = command.options.map((option) => ApplicationCommand['transformOption'](option as any) as APIApplicationCommandOption);\n\t}\n\n\treturn returnData;\n}\n"]}